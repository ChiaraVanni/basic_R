---
title: "R workshop"
author: "David Benito & Matt Schechter"
date: "January 2018"
output: html_document
---

# Why R?
***
# Downloading R and RStudio
***
R versions can be downloaded from the [Comprehensive R Archive Network website](https://cran.r-project.org/). RStudio can be downloaded from the [website](https://www.rstudio.com/products/rstudio/download/).


# Introduction to R programming language
## Intro
Using hashtags (#) to include comments is highly recommended and makes code understandable. Example:

```{r}
print("Hello") # This command prints an initial greeting :)
```

## How to get help!
Finding help with R
***

Use `?` to read the help page of functions or data sets. For example:

`?R.version`

Also check [Stack Overflow](https://stackoverflow.com/questions/tagged/r) frequently :)

## Object names

* Case sensitive
* With letters, numbers, "." and "_". They should start with a letter.
* Avoid using function or operator names: `function`, `if`, `c`...
* Assign objects to names using `<-` (equivalent to `=`). The typing shortcut is `Cntr + -`.

## Data objects

* Vectors
* Factors. For qualitative data.
* Arrays. Vectors organised by rows and columns.
* Data frames. Like an array but can contain columns of different types. The columns are called *variables*.

Some examples:

```{r}
# Vectors
x <- c(8,2,5,6,7)
y <- c(34,23,67,65,23)
z <- c(TRUE, TRUE, FALSE, FALSE, TRUE)

# Factors
a <- factor(c(1,2,3,4,5))
b <- factor(c("a", "b", "c", "d", "e"))

# Array
num.data <- array(c(x, y, z), dim=c(5,3))
num.data # Note that the logical vector is turned into a vector of 0 and 1.
# You can also transpose an array:
num.data.t <- t(num.data)
num.data.t

# Data frame
my.data <- data.frame(num.data, row.names = b)
my.data
# You can also create your data frame in a more organised way:
my.data.org <- data.frame(x, y, z, row.names = b)
my.data.org
```

## Attributes of the objects and their functions

* Attributes `attributes`
* Mode `mode`
* Type `typeof`
* Names `names`
* Dimensions `dim`
* Names of the dimensions `dimnames`
* Class `class`

Check what are the attributes of the objects created before. For example:

```{r}
dim(x)
dim(my.data)
dimnames(my.data)
# etc
```

## Basic maths and statistics in R

* `+`, `-`, `*` and `/`
* `^` and `sqrt`
* `exp`, `log`, `log10`, `log2`, `logb(x, base)`
* `max`, `min`, `range`, `mean`, `median`, `var`, `sd`, `quantile`, `sum`...
* Logical operators: `<`, `<=`, `>`, `>=`, `==` (*equal to*), `!=` (*not equal to*), `&&` (*and*), `||` (*or*).
* Logical clauses `if() {} else {}`.
* Set operations: `union(x, y)`, `intersect(x, y)`...

Examples:

```{r}
x^2
x+y
sum(x)
mean(x)
median(x)
var(x)

if(min(x)>1 && min(y)<10) {
  print("Yes")
} else {
  print("No")
}

if(min(x)>1 || min(y)<10) {
  print("Yes")
} else {
  print("No")
}
```

## Subsetting 

Vectors: generate sequences and select values

With the function `c()` we can generate strings of values. With the coordinates (using square brackets `[]`) we can select specific elements from strings. With the symbol `$` we can access columns in a data frame by the variable name.

Examples:

```{r}
# Generate a vector of consecutive numbers:
g <- c(1:7)
g

# Generate vectors of repeated values:
h <- rep(4, 7)
h

# Select specific elements from a vector
x
x[2]
x[c(2,4)]
x[2:4]

# Select specific elements from a matrix.
num.data
num.data[1, 1]
num.data[1:3, c(1,3)]
# This is useful to make subsets:
num.data.subset <- num.data[,1:2]
num.data.subset

# You can also create strings of letters
my.letters <- letters[1:6]
my.letters
# Also capital letters.
MY.LETTERS <- LETTERS[1:6]
MY.LETTERS

# Access the variables in a data frame.
my.data.org$x
my.data.org$y
```

### Generate random sequences

* Check `?sample`

```{r}
sample(10)
sample(10, 4)
sample(10, replace=TRUE)
sample(x, prob=(x/sum(x)))
```

* Random distributions. In general, `rDistribution` generates a random distribution with a given sample size (first argument) and given parameters.  Examples:
    * Normal distribution `rnorm`
    * Student $t$ distribution `rt`
    * Poisson distribution `rpois`
    * $\chi ^2$ distribution `rchisq`


R keeps an index of any of the elements in the different data structures and we can use subsetting to select or exclude any of these elements. [Here](http://www.statmethods.net/management/subset.html) and [here](http://adv-r.had.co.nz/Subsetting.html) you can find very good explanations about subsetting the different data structures using the subsetting operators **[**, **$** or **[[**.

<br />

For the most simple data structures, *vectors*, we can use the operator **[** to get the elements by their position or index. Positions in R starts at 1. For example let's get the second element of *v_character*: 

```{r}
v_character
v_character[2]
```

Or the second and third:

```{r}
v_character[2:3]
```

In the case we don't specify anything we will get the original vector:

```{r}
v_character[]
```

<br />

For *lists* we can use the operator **[**, that will return a list or **[[** and **$** that will return the elements of the list. Let's see some examples with the **l_named** we created before:

```{r}
l_named
```

Let's get the elements in postion 3 in the list **l_named**:

```{r}
l_named[3]
class(l_named)
```

We can see that the returned oject after subseeting is a list (use **?class** to learn more about it). But if we want to get the elements in position 3 we should use **[[3]]** or as we have a named list we can use **$bool**. Let's see an example:

```{r}
l_named[[3]]
l_named$bool
class(l_named[[3]])
class(l_named$bool)
```

Now we are accessing to the elements and *class* is telling us that is a logical vector.


# RStudio interface
***
1. Script window
2. Console
3. Environment. Where data objects/R objects are stored
4. Plot/Help/etc window


# Upload and Exporting

Have a csv for them to upload and manipulate

# Installing Packages

Which packages are currently loaded?
```{r}
sessionInfo()
```


# RStudio Projects
# R markdown and R notebooks

#

For *matrices* and *data frames* are similar than for vectors, but here we have to dimensions and when using the operator **[** we need to specify rows and columns this way **[row, column]**. Let's see some examples with our data frame **df** that has three rows and two columns:

```{r}
df
```

Let's get first row:

```{r}
df[1,]
```

And second column:

```{r}
df[,2]
```

Or the element in the third row and second column:

```{r}
df[3, 2]
```

As you can see in the result we get an extra line with **Levels: a b c**. Those are factors, another data type that is very important and useful but we will not cover in this course, but you can learn more about them [here](http://rforpublichealth.blogspot.de/2012/11/data-types-part-3-factors.html)


```{r}
# To visualise it in a histogram
hist(rnorm(100, mean=0, sd=1)) # 100 samples of mean=0 and SD=1 from a normal distribution.
```

Use `dnorm` for density at a value, `pnorm` for distribution function and `qnorm` for quantile function. Same for other distributions.

### The element "not available"

Identifying and replacing NA values in our datasets can be useful:

```{r}
v <- c(1, 5, 19, 2, 23, NA, 3, 9, NA)
v

is.na(v)
which(is.na(v))

# Create a vector without the NAs
w <- v[!is.na(v)]
w

# Substitute NAs for e.g. 0
v2 <- v
v2[is.na(v2)] <- 0
v2

# Inf (infinite) and NaN (not a number) are different from NA:
5/0
0/0
is.infinite(5/0)
is.nan(0/0)

# NAs can be removed in some functions
mean(v)
mean(v, na.rm=TRUE)
```

For linear models (`lm` function) one can use `na.omit` or `na.exclude`. 

### Ordering & sorting

```{r}
my.data
order(my.data) # Orders the items in a data frame. By default in increasing order. The output is the position of the elements in the data frame.
order(my.data, decreasing = TRUE)

v2
sort(v2) # Orders the elements in a vector
sort(my.letters, decreasing = T)
my.data
# sort doesn't work for data frames, but works with vectors within a data frame:
sort(my.data$X1)
```

### Importing data from Excel

To import a dataset from Excel the best is to save the Excel file as a comma-separated values (`.csv`) or a tab-separated values (`.tsv`) file.

The `.csv` and `.tsv` files can be imported from the tab "Environment" in RStudio: Import Dataset --> From text.

Alternatively, you can use the following command:

```{r}
# Make sure you're in the working directory where the file is:
#R_workshop <- read.csv("D:/Workshops/201901_R_workshop/R_workshop.csv", sep=";")
```

The package `readxl` is designed to deal with `.xlsx` files. One advantage is that it has functions that allow to read files with more than one spreadsheet.

### Packages

A package is file containing some functions designed for a specific task(s). For example, `ggplot2` is very useful to create elegant plots and the package `vegan` is used for ecological analyses.

To install a package and to activate it in the current workspace do as follows:

```
# To install a package (this task can take a while and may ask for additional packages to be installed):
install.packages("ggplot2")

# To call the package and use its functions in the current session use:
library(ggplot2) # or:
require(ggplot2)
```

Using the [Bioconductor](https://bioconductor.org/) software to install packages is highly recommended, especaially with the latest R versions:

```{r}
#if (!requireNamespace("BiocManager"))
#    install.packages("BiocManager")   # This command installs BiocManager if it's not installed already.

#BiocManager::install("ggplot2")

#require(ggplot2)
```

### Saving a workspace

It is highly recommended to save the elements created in the session. This is especially important when the functions/analyses done on the data took a long time.

You can save a workspace from the Environment window or with the following command:

```{r}
#save.image("D:/Workshops/201901_R_workshop/R_workshop.RData") # Specify the path where to save the workspace.
```

A workspace can also be saved upon closing the RStudio session.

To load a saved workspace, use the load button in the Environment window or use the following command:

```{r}
#oad("D:/Workshops/201901_R_workshop/R_workshop.RData")
```
### Working directories

```{r}
#setwd("C:/Users/dbenito/Documents/") # Set the working directory
#getwd() # Prints the directory we're working at.
```
