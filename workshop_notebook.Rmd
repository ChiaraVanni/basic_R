---
title: "R workshop"
author: "David Benito & Matt Schechter"
date: "January 2018"
output: html_document
---


### Downloading R and RStudio

R versions can be downloaded from the [Comprehensive R Archive Network website](https://cran.r-project.org/). RStudio can be downloaded from the [website](https://www.rstudio.com/products/rstudio/download/).

### RStudio interface

1. Script window
2. Console
3. Environment. Where data objects/R objects are stored
4. Plot/Help/etc window

### Use some help

Use `?` to read the help page of functions or data sets. For example:

`?R.version`

Also check [Stack Overflow](https://stackoverflow.com/questions/tagged/r) frequently :)

Using hashtags (#) to include comments is highly recommended and makes code understandable. Example:

```{r}
print("Hello") # This command prints an initial greeting :)
```

### Working directories

```{r}
#setwd("C:/Users/dbenito/Documents/") # Set the working directory
#getwd() # Prints the directory we're working at.
```

### Data objects

* Vectors
* Factors. For qualitative data.
* Arrays. Vectors organised by rows and columns.
* Data frames. Like an array but can contain columns of different types. The columns are called *variables*.

Some examples:

```{r}
# Vectors
x <- c(8,2,5,6,7)
y <- c(34,23,67,65,23)
z <- c(TRUE, TRUE, FALSE, FALSE, TRUE)

# Factors
a <- factor(c(1,2,3,4,5))
b <- factor(c("a", "b", "c", "d", "e"))

# Array
num.data <- array(c(x, y, z), dim=c(5,3))
num.data # Note that the logical vector is turned into a vector of 0 and 1.
# You can also transpose an array:
num.data.t <- t(num.data)
num.data.t

# Data frame
my.data <- data.frame(num.data, row.names = b)
my.data
# You can also create your data frame in a more organised way:
my.data.org <- data.frame(x, y, z, row.names = b)
my.data.org
```

### Attributes of the objects and their functions

* Attributes `attributes`
* Mode `mode`
* Type `typeof`
* Names `names`
* Dimensions `dim`
* Names of the dimensions `dimnames`
* Class `class`

Check what are the attributes of the objects created before. For example:

```{r}
dim(x)
dim(my.data)
dimnames(my.data)
# etc
```

### Object names

* Case sensitive
* With letters, numbers, "." and "_". They should start with a letter.
* Avoid using function or operator names: `function`, `if`, `c`...
* Assign objects to names using `<-` (equivalent to `=`). The typing shortcut is `Cntr + -`.

### Basic maths and statistics in R

* `+`, `-`, `*` and `/`
* `^` and `sqrt`
* `exp`, `log`, `log10`, `log2`, `logb(x, base)`
* `max`, `min`, `range`, `mean`, `median`, `var`, `sd`, `quantile`, `sum`...
* Logical operators: `<`, `<=`, `>`, `>=`, `==` (*equal to*), `!=` (*not equal to*), `&&` (*and*), `||` (*or*).
* Logical clauses `if() {} else {}`.
* Set operations: `union(x, y)`, `intersect(x, y)`...

Examples:

```{r}
x^2
x+y
sum(x)
mean(x)
median(x)
var(x)

if(min(x)>1 && min(y)<10) {
  print("Yes")
} else {
  print("No")
}

if(min(x)>1 || min(y)<10) {
  print("Yes")
} else {
  print("No")
}
```

### Vectors: generate sequences and select values

With the function `c()` we can generate strings of values. With the coordinates (using square brackets `[]`) we can select specific elements from strings. With the symbol `$` we can access columns in a data frame by the variable name.

Examples:

```{r}
# Generate a vector of consecutive numbers:
g <- c(1:7)
g

# Generate vectors of repeated values:
h <- rep(4, 7)
h

# Select specific elements from a vector
x
x[2]
x[c(2,4)]
x[2:4]

# Select specific elements from a matrix.
num.data
num.data[1, 1]
num.data[1:3, c(1,3)]
# This is useful to make subsets:
num.data.subset <- num.data[,1:2]
num.data.subset

# You can also create strings of letters
my.letters <- letters[1:6]
my.letters
# Also capital letters.
MY.LETTERS <- LETTERS[1:6]
MY.LETTERS

# Access the variables in a data frame.
my.data.org$x
my.data.org$y
```

### Generate random sequences

* Check `?sample`

```{r}
sample(10)
sample(10, 4)
sample(10, replace=TRUE)
sample(x, prob=(x/sum(x)))
```

* Random distributions. In general, `rDistribution` generates a random distribution with a given sample size (first argument) and given parameters.  Examples:
    * Normal distribution `rnorm`
    * Student $t$ distribution `rt`
    * Poisson distribution `rpois`
    * $\chi ^2$ distribution `rchisq`

```{r}
# To visualise it in a histogram
hist(rnorm(100, mean=0, sd=1)) # 100 samples of mean=0 and SD=1 from a normal distribution.
```

Use `dnorm` for density at a value, `pnorm` for distribution function and `qnorm` for quantile function. Same for other distributions.

### The element "not available"

Identifying and replacing NA values in our datasets can be useful:

```{r}
v <- c(1, 5, 19, 2, 23, NA, 3, 9, NA)
v

is.na(v)
which(is.na(v))

# Create a vector without the NAs
w <- v[!is.na(v)]
w

# Substitute NAs for e.g. 0
v2 <- v
v2[is.na(v2)] <- 0
v2

# Inf (infinite) and NaN (not a number) are different from NA:
5/0
0/0
is.infinite(5/0)
is.nan(0/0)

# NAs can be removed in some functions
mean(v)
mean(v, na.rm=TRUE)
```

For linear models (`lm` function) one can use `na.omit` or `na.exclude`. 

### Ordering & sorting

```{r}
my.data
order(my.data) # Orders the items in a data frame. By default in increasing order. The output is the position of the elements in the data frame.
order(my.data, decreasing = TRUE)

v2
sort(v2) # Orders the elements in a vector
sort(my.letters, decreasing = T)
my.data
# sort doesn't work for data frames, but works with vectors within a data frame:
sort(my.data$X1)
```

### Importing data from Excel

To import a dataset from Excel the best is to save the Excel file as a comma-separated values (`.csv`) or a tab-separated values (`.tsv`) file.

The `.csv` and `.tsv` files can be imported from the tab "Environment" in RStudio: Import Dataset --> From text.

Alternatively, you can use the following command:

```{r}
# Make sure you're in the working directory where the file is:
#R_workshop <- read.csv("D:/Workshops/201901_R_workshop/R_workshop.csv", sep=";")
```

The package `readxl` is designed to deal with `.xlsx` files. One advantage is that it has functions that allow to read files with more than one spreadsheet.

### Packages

A package is file containing some functions designed for a specific task(s). For example, `ggplot2` is very useful to create elegant plots and the package `vegan` is used for ecological analyses.

To install a package and to activate it in the current workspace do as follows:

```
# To install a package (this task can take a while and may ask for additional packages to be installed):
install.packages("ggplot2")

# To call the package and use its functions in the current session use:
library(ggplot2) # or:
require(ggplot2)
```

Using the [Bioconductor](https://bioconductor.org/) software to install packages is highly recommended, especaially with the latest R versions:

```{r}
#if (!requireNamespace("BiocManager"))
#    install.packages("BiocManager")   # This command installs BiocManager if it's not installed already.

#BiocManager::install("ggplot2")

#require(ggplot2)
```

### Saving a workspace

It is highly recommended to save the elements created in the session. This is especially important when the functions/analyses done on the data took a long time.

You can save a workspace from the Environment window or with the following command:

```{r}
#save.image("D:/Workshops/201901_R_workshop/R_workshop.RData") # Specify the path where to save the workspace.
```

A workspace can also be saved upon closing the RStudio session.

To load a saved workspace, use the load button in the Environment window or use the following command:

```{r}
#oad("D:/Workshops/201901_R_workshop/R_workshop.RData")
```

